<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Noticias sobre Conspiraciones y Teorías Alternativas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&display=swap" rel="stylesheet">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --bg: #f7f9fc;
      --card: #fff;
      --accent: #5c6bc0;
      --text: #333;
      --muted: #777;
      --column-bg-es: #e8f0fe;
      --column-bg-en: #fce8e8;
    }
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    body{
      font-family: 'Poppins', sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 20px 10px;
    }
    header{
      text-align: center;
      margin-bottom: 30px;
    }
    header h1{
      font-size: 1.6rem;
      font-weight: 600;
    }
    header p{ color: var(--muted); font-size: 0.9rem; }

    /* Botón flotante de idioma */
    #lang-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 999;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      font-size: 1.3rem;
      box-shadow: 0 4px 12px rgba(0,0,0,.25);
      cursor: pointer;
      transition: transform .3s;
    }
    #lang-toggle:hover { transform: scale(1.1); }

    .columns-container{
      display: flex;
      flex-direction: column;
      gap: 25px;
      max-width: 1400px;
      margin: auto;
    }
    .column{
      background: var(--card);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,.08);
    }
    .column-es{ background: var(--column-bg-es); }
    .column-en{ background: var(--column-bg-en); display: none; } /* oculta inglés por defecto */
    .show-both .column-en{ display: block; }

    .column-header{
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--accent);
    }
    .column-header h2{ font-size: 1.1rem; }

    .news-grid{
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
    }
    .card{
      background: var(--card);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,.06);
      transition: .3s;
      display: flex;
      flex-direction: column;
    }
    .card:hover{
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,.1);
    }
    .card img{
      width: 100%;
      height: 160px;
      object-fit: cover;
    }
    .card-content{
      padding: 12px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .card-content h3{
      font-size: 1rem;
      line-height: 1.3;
      margin-bottom: 6px;
    }
    .source{
      font-size: .75rem;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .date{
      font-size: .7rem;
      color: var(--accent);
      margin-bottom: 6px;
    }
    .description{
      font-size: .8rem;
      color: var(--muted);
      margin-bottom: 8px;
      flex-grow: 1;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .card-content a{
      margin-top: auto;
      color: var(--accent);
      font-weight: 600;
      text-decoration: none;
      font-size: .8rem;
    }
    .card-content a:hover{ text-decoration: underline; }

    .loading, .error-message{
      text-align: center;
      padding: 40px 10px;
      color: var(--muted);
      font-size: .9rem;
    }
    .load-more{
      display: block;
      margin: 20px auto;
      padding: 10px 24px;
      border: none;
      border-radius: 30px;
      background: var(--accent);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: .3s;
    }
    .load-more:hover{ background: #455a64; }
    .load-more:disabled{ background: var(--muted); cursor: not-allowed; }

    /* Escritorio */
    @media (min-width: 768px){
      body{ padding: 30px 15px; }
      .columns-container{ flex-direction: row; }
      .column{ flex: 1; min-width: 300px; }
      header h1{ font-size: 2.2rem; }
      .column-header h2{ font-size: 1.3rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1><i class="fas fa-eye"></i> Noticias sobre Conspiraciones y Teorías Alternativas</h1>
    <p>Últimas novedades acerca de teorías conspirativas y enfoques alternativos</p>
    <p style="font-size: 0.8rem; color: var(--muted); margin-top: 6px;">
      <i class="fas fa-shield-alt"></i> Todas las noticias provienen de fuentes legítimas y verificadas
    </p>
  </header>

  <div id="api-status" class="loading" style="display: none;">
    <i class="fas fa-check-circle"></i> Conectado a APIs de noticias en tiempo real
  </div>

  <div class="columns-container">
    <!-- Español -->
    <div class="column column-es">
      <div class="column-header">
        <i class="fas fa-flag"></i>
        <h2>Noticias en Español</h2>
      </div>
      <div id="news-es" class="news-grid">
        <div class="loading"><i class="fas fa-spinner fa-spin"></i> Cargando noticias verificadas…</div>
      </div>
    </div>

    <!-- English -->
    <div class="column column-en">
      <div class="column-header">
        <i class="fas fa-flag-usa"></i>
        <h2>News in English</h2>
      </div>
      <div id="news-en" class="news-grid">
        <div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading verified news…</div>
      </div>
    </div>
  </div>

  <button id="load-more" class="load-more">Cargar más noticias verificadas</button>

  <!-- Botón flotante de idioma -->
  <button id="lang-toggle" title="Cambiar idioma">
    <i class="fas fa-language"></i>
  </button>

  <script>
    /* ===== CONFIGURACIÓN DE APIS ===== */
    const API_KEYS = {
      GNEWS: '42dd93284a0abf72a9a646d3b4a9c33e',
      NEWSAPI: 'aaf83dcbd8694668ad89247b959db678',
      NEWSDATA: 'pub_a6e9ca27cc1644bf9a1cff0b8686b3eb'
    };

    const articlesPerPage = 6;
    const conspiracyKeywords = [
      'conspiración','conspiracy','teoría','theory','alternativa','alternative','secreto','secret',
      'deep state','nuevo orden mundial','new world order','illuminati','ufos','ufo','extraterrestres',
      'aliens','cover-up','ocultismo','occult','hidden truth','verdad oculta','shadow government',
      'gobierno en la sombra','elite control','control elite','masonería','freemasonry','qanon',
      'q-anon','planificación','plot','scheme','manipulación','manipulation'
    ];

    /* ===== REFERENCIAS DOM ===== */
    const newsEsContainer = document.getElementById('news-es');
    const newsEnContainer = document.getElementById('news-en');
    const loadMoreBtn = document.getElementById('load-more');
    const apiStatus = document.getElementById('api-status');

    /* ===== ESTADO GLOBAL ===== */
    let currentPageEs = 1;
    let currentPageEn = 1;
    let allArticlesEs = [];
    let allArticlesEn = [];
    let isLoading = false;

    /* ===== FUNCIONES AUXILIARES ===== */
    function isConspiracyRelated(article) {
      if (!article.title && !article.description) return false;
      const text = (article.title + ' ' + (article.description || '')).toLowerCase();
      return conspiracyKeywords.some(kw => text.includes(kw.toLowerCase()));
    }

    function getImageUrl(article) {
      return article.urlToImage || article.image || article.image_url || article.urlToimage ||
             'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop&auto=format&q=80';
    }

    /* ===== LLAMADAS A APIS ===== */
    async function fetchFromGNews(lang, page = 1) {
      try {
        const query = lang === 'es'
          ? 'conspiración OR "teoría conspirativa" OR "nuevo orden mundial" OR illuminati OR ufos'
          : 'conspiracy OR "conspiracy theory" OR "new world order" OR illuminati OR ufo OR "deep state" OR qanon OR "shadow government"';
        const country = lang === 'es' ? 'es' : 'us';
        const url = `https://gnews.io/api/v4/search?q=${encodeURIComponent(query)}&lang=${lang}&country=${country}&max=20&page=${page}&apikey=${API_KEYS.GNEWS}`;
        const res = await fetch(url);
        const data = await res.json();
        return (data.articles || [])
          .filter(a => a.title && a.url && a.source && !a.title.toLowerCase().includes('removed'))
          .map(a => ({ ...a, urlToImage: getImageUrl(a) }));
      } catch { return []; }
    }

    async function fetchFromNewsAPI(lang, page = 1) {
      try {
        const query = lang === 'es'
          ? 'conspiración OR "teoría conspirativa" OR "nuevo orden mundial" OR illuminati OR ufos'
          : 'conspiracy OR "conspiracy theory" OR "new world order" OR illuminati OR ufo OR "deep state" OR qanon';
        const from = new Date(Date.now() - 30*24*60*60*1000).toISOString().split('T')[0];
        const proxy = 'https://corsproxy.io/?';
        const target = `https://newsapi.org/v2/everything?q=${encodeURIComponent(query)}&language=${lang}&from=${from}&sortBy=publishedAt&pageSize=30&page=${page}&apiKey=${API_KEYS.NEWSAPI}`;
        const res = await fetch(proxy + encodeURIComponent(target));
        const data = await res.json();
        return (data.articles || [])
          .filter(a => a.title && a.url && a.source && !a.title.toLowerCase().includes('removed'))
          .map(a => ({ ...a, urlToImage: getImageUrl(a) }));
      } catch { return []; }
    }

    async function fetchFromNewsData(lang) {
      try {
        const query = lang === 'es'
          ? 'conspiración,teoría conspirativa,nuevo orden mundial,illuminati,ufos'
          : 'conspiracy,conspiracy theory,new world order,illuminati,ufo,deep state';
        const language = lang === 'es' ? 'es' : 'en';
        const url = `https://newsdata.io/api/1/news?apikey=${API_KEYS.NEWSDATA}&q=${encodeURIComponent(query)}&language=${language}&category=world`;
        const res = await fetch(url);
        const data = await res.json();
        return (data.results || [])
          .filter(a => a.title && a.link && a.source_id && !a.title.toLowerCase().includes('removed'))
          .map(a => ({
            title: a.title,
            description: a.description,
            url: a.link,
            urlToImage: getImageUrl(a),
            publishedAt: a.pubDate,
            source: { name: a.source_id }
          }));
      } catch { return []; }
    }

    async function fetchNews(lang, page = 1) {
      let articles = [];
      articles = await fetchFromGNews(lang, page);
      if (articles.length) return articles;
      articles = await fetchFromNewsAPI(lang, page);
      if (articles.length) return articles;
      articles = await fetchFromNewsData(lang);
      return articles;
    }

    /* ===== RENDER ===== */
    function renderArticles(articles, container, lang) {
      if (!articles.length) {
        container.innerHTML = `<div class="error-message">
          <i class="fas fa-exclamation-circle"></i>
          ${lang === 'es' ? 'No se encontraron noticias en este momento.' : 'No news found at this time.'}
        </div>`;
        return;
      }
      container.innerHTML = '';
      articles.forEach((art, idx) => {
        const card = document.createElement('div');
        card.className = 'card';
        const date = new Date(art.publishedAt).toLocaleDateString(lang === 'es' ? 'es-ES' : 'en-US',
          { year: 'numeric', month: 'long', day: 'numeric' });
        const fallback = 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop&auto=format&q=80';
        card.innerHTML = `
          <img src="${art.urlToImage || fallback}" alt="${art.title}" loading="lazy" onerror="this.src='${fallback}'">
          <div class="card-content">
            <span class="date">${date}</span>
            <h3>${art.title} <span class="authenticity-badge">✓ Verificada</span></h3>
            <div class="source"><i class="fas fa-newspaper"></i> ${art.source.name || 'Unknown'}</div>
            ${art.description ? `<div class="description">${art.description}</div>` : ''}
            <a href="${art.url}" target="_blank" rel="noopener noreferrer">${lang === 'es' ? 'Leer más →' : 'Read more →'}</a>
          </div>
        `;
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        container.appendChild(card);
        setTimeout(() => {
          card.style.transition = 'opacity .3s, transform .3s';
          card.style.opacity = '1';
          card.style.transform = 'translateY(0)';
        }, idx * 100);
      });
    }

    /* ===== CARGA Y “CARGAR MÁS” ===== */
    async function loadAndShowArticles() {
      if (isLoading) return;
      isLoading = true;
      loadMoreBtn.disabled = true;
      loadMoreBtn.textContent = 'Cargando…';
      apiStatus.style.display = 'block';

      try {
        const [newEs, newEn] = await Promise.all([
          fetchNews('es', currentPageEs),
          fetchNews('en', currentPageEn)
        ]);
        const uniqueEs = newEs.filter(n => !allArticlesEs.some(e => e.url === n.url));
        const uniqueEn = newEn.filter(n => !allArticlesEn.some(e => e.url === n.url));
        if (uniqueEs.length) allArticlesEs.push(...uniqueEs);
        if (uniqueEn.length) allArticlesEn.push(...uniqueEn);

        renderArticles(allArticlesEs.slice(0, currentPageEs * articlesPerPage), newsEsContainer, 'es');
        renderArticles(allArticlesEn.slice(0, currentPageEn * articlesPerPage), newsEnContainer, 'en');

        const hasMore = uniqueEs.length || uniqueEn.length;
        if (hasMore) {
          if (uniqueEs.length) currentPageEs++;
          if (uniqueEn.length) currentPageEn++;
          loadMoreBtn.disabled = false;
          loadMoreBtn.textContent = 'Cargar más noticias verificadas';
          loadMoreBtn.style.display = 'block';
        } else {
          loadMoreBtn.style.display = 'none';
        }
      } catch (err) {
        console.error(err);
        if (!allArticlesEs.length && !allArticlesEn.length) {
          newsEsContainer.innerHTML = '<div class="error-message"><i class="fas fa-exclamation-triangle"></i> Error al conectar.</div>';
          newsEnContainer.innerHTML = '<div class="error-message"><i class="fas fa-exclamation-triangle"></i> Connection error.</div>';
        }
        loadMoreBtn.disabled = false;
        loadMoreBtn.textContent = 'Cargar más noticias verificadas';
      } finally {
        isLoading = false;
      }
    }

    loadMoreBtn.addEventListener('click', loadAndShowArticles);
    loadAndShowArticles();

    /* ===== BOTÓN DE IDIOMA ===== */
    const toggleBtn = document.getElementById('lang-toggle');
    const container = document.querySelector('.columns-container');
    let currentMode = 'es'; // español solo por defecto

    toggleBtn.addEventListener('click', () => {
      if (currentMode === 'es') {
        container.classList.remove('show-both');
        document.querySelector('.column-es').style.display = 'none';
        document.querySelector('.column-en').style.display = 'block';
        currentMode = 'en';
      } else if (currentMode === 'en') {
        container.classList.add('show-both');
        document.querySelector('.column-es').style.display = 'block';
        document.querySelector('.column-en').style.display = 'block';
        currentMode = 'both';
      } else {
        container.classList.remove('show-both');
        document.querySelector('.column-es').style.display = 'block';
        document.querySelector('.column-en').style.display = 'none';
        currentMode = 'es';
      }
    });
  </script>
</body>
</html>
