<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Noticias sobre Conspiraciones y Teorías Alternativas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&display=swap" rel="stylesheet">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --bg: #f7f9fc;
      --card: #fff;
      --accent: #5c6bc0;
      --text: #333;
      --muted: #777;
      --column-bg-es: #e8f0fe;
      --column-bg-en: #fce8e8;
    }
    *, *::before, *::after {margin:0;padding:0;box-sizing:border-box;}
    body{
      font-family:'Poppins',sans-serif;
      background:var(--bg);
      color:var(--text);
      padding:30px 15px;
    }
    header{
      text-align:center;
      margin-bottom:40px;
    }
    header h1{
      font-size:2.2rem;
      font-weight:600;
    }
    header p{color:var(--muted);}
    .columns-container{
      display:flex;
      flex-wrap:wrap;
      gap:25px;
      max-width:1400px;
      margin:auto;
      justify-content:center;
    }
    .column{
      flex:1;
      min-width:300px;
      background:var(--card);
      border-radius:12px;
      padding:20px;
      box-shadow:0 4px 12px rgba(0,0,0,.08);
    }
    .column-es{background:var(--column-bg-es);}
    .column-en{background:var(--column-bg-en);}
    .column-header{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      margin-bottom:20px;
      padding-bottom:10px;
      border-bottom:2px solid var(--accent);
    }
    .news-grid{
      display:grid;
      grid-template-columns:1fr;
      gap:20px;
    }
    .card{
      background:var(--card);
      border-radius:12px;
      overflow:hidden;
      box-shadow:0 4px 8px rgba(0,0,0,.06);
      transition:.3s;
      display:flex;
      flex-direction:column;
    }
    .card:hover{
      transform:translateY(-4px);
      box-shadow:0 6px 12px rgba(0,0,0,.1);
    }
    .card img{
      width:100%;
      height:180px;
      object-fit:cover;
    }
    .card-content{
      padding:18px;
      flex:1;
      display:flex;
      flex-direction:column;
    }
    .card-content h3{
      font-size:1.1rem;
      line-height:1.4;
      margin-bottom:10px;
    }
    .card-content .source{
      font-size:.85rem;
      color:var(--muted);
      margin-bottom:10px;
    }
    .card-content .date{
      font-size:.8rem;
      color:var(--accent);
      margin-bottom:8px;
    }
    .card-content .description{
      font-size:.9rem;
      color:var(--muted);
      margin-bottom:12px;
      flex-grow:1;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .card-content a{
      margin-top:auto;
      align-self:flex-start;
      color:var(--accent);
      font-weight:600;
      text-decoration:none;
    }
    .card-content a:hover{text-decoration:underline;}
    .loading{
      text-align:center;
      padding:60px;
      color:var(--muted);
    }
    .load-more{
      display:block;
      margin:30px auto;
      padding:12px 28px;
      border:none;
      border-radius:30px;
      background:var(--accent);
      color:#fff;
      font-weight:600;
      cursor:pointer;
      transition:.3s;
      box-shadow:0 2px 6px rgba(0,0,0,.1);
    }
    .load-more:hover{
      background:#455a64;
      transform:translateY(-2px);
    }
    .load-more:disabled{
      background:var(--muted);
      cursor:not-allowed;
    }
    .error-message {
      background: #ffebee;
      color: #c62828;
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
      border-left: 4px solid #c62828;
      text-align: center;
    }
    .api-status {
      background: #e8f5e8;
      color: #2e7d32;
      padding: 10px 15px;
      border-radius: 8px;
      margin: 10px auto;
      max-width: 600px;
      border-left: 4px solid #4caf50;
      text-align: center;
      font-size: 0.9rem;
    }
    .authenticity-badge {
      background: #e3f2fd;
      color: #1976d2;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.7rem;
      margin-left: 5px;
      display: inline-block;
    }
    @media(max-width:768px){
      .columns-container{flex-direction:column;}
    }
  </style>
</head>
<body>
  <header>
    <h1><i class="fas fa-eye"></i> Noticias sobre Conspiraciones y Teorías Alternativas</h1>
    <p>Últimas novedades acerca de teorías conspirativas y enfoques alternativos en español e inglés</p>
    <p style="font-size: 0.9rem; color: var(--muted); margin-top: 10px;">
      <i class="fas fa-shield-alt"></i> Todas las noticias provienen de fuentes legítimas y verificadas
    </p>
  </header>

  <div id="api-status" class="api-status" style="display: none;">
    <i class="fas fa-check-circle"></i> 
    Conectado a APIs de noticias en tiempo real
  </div>

  <div class="columns-container">
    <!-- Español -->
    <div class="column column-es">
      <div class="column-header">
        <i class="fas fa-language"></i>
        <h2>Noticias en Español</h2>
      </div>
      <div id="news-es" class="news-grid">
        <div class="loading"><i class="fas fa-spinner fa-spin"></i> Cargando noticias verificadas…</div>
      </div>
    </div>

    <!-- English -->
    <div class="column column-en">
      <div class="column-header">
        <i class="fas fa-language"></i>
        <h2>News in English</h2>
      </div>
      <div id="news-en" class="news-grid">
        <div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading verified news…</div>
      </div>
    </div>
  </div>

  <button id="load-more" class="load-more">Cargar más noticias verificadas</button>

  <script>
    // API Configuration
    const API_KEYS = {
      GNEWS: '42dd93284a0abf72a9a646d3b4a9c33e',
      NEWSAPI: 'aaf83dcbd8694668ad89247b959db678',
      NEWSDATA: 'pub_a6e9ca27cc1644bf9a1cff0b8686b3eb'
    };

    const articlesPerPage = 6;
    
    // Keywords for conspiracy-related content from real sources
    const conspiracyKeywords = [
      'conspiración','conspiracy','teoría','theory','alternativa','alternative','secreto','secret',
      'deep state','nuevo orden mundial','new world order','illuminati','ufos','ufo','extraterrestres',
      'aliens','cover-up','ocultismo','occult','hidden truth','verdad oculta','shadow government',
      'gobierno en la sombra','elite control','control elite','masonería','freemasonry','qanon',
      'q-anon','planificación','plot','scheme','manipulación','manipulation'
    ];

    // DOM references
    const newsEsContainer = document.getElementById('news-es');
    const newsEnContainer = document.getElementById('news-en');
    const loadMoreBtn = document.getElementById('load-more');
    const apiStatus = document.getElementById('api-status');

    // State
    let currentPageEs = 1;
    let currentPageEn = 1;
    let allArticlesEs = [];
    let allArticlesEn = [];
    let isLoading = false;

    // Check if article is conspiracy-related
    function isConspiracyRelated(article) {
      if (!article.title && !article.description) return false;
      const text = (article.title + ' ' + (article.description || '')).toLowerCase();
      
      return conspiracyKeywords.some(keyword => {
        return text.includes(keyword.toLowerCase());
      });
    }

    // Enhanced image handling
    function getImageUrl(article) {
      // Try multiple possible image sources
      return article.urlToImage || 
             article.image || 
             article.image_url || 
             article.urlToimage ||
             'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop&auto=format&q=80';
    }

    // Fetch from GNews API - FIXED IMAGE HANDLING
    async function fetchFromGNews(lang, page = 1) {
      try {
        let query;
        if (lang === 'es') {
          query = 'conspiración OR "teoría conspirativa" OR "nuevo orden mundial" OR illuminati OR ufos';
        } else {
          query = 'conspiracy OR "conspiracy theory" OR "new world order" OR illuminati OR ufo OR "deep state" OR qanon OR "shadow government"';
        }
        
        const country = lang === 'es' ? 'es' : 'us';
        
        const url = `https://gnews.io/api/v4/search?q=${encodeURIComponent(query)}&lang=${lang}&country=${country}&max=20&page=${page}&apikey=${API_KEYS.GNEWS}`;
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.articles) {
          return data.articles
            .filter(article => 
              article.title && 
              article.url && 
              article.source &&
              !article.title.toLowerCase().includes('[removed]') &&
              !article.title.toLowerCase().includes('removed')
            )
            .map(article => ({
              ...article,
              urlToImage: getImageUrl(article)
            }));
        }
        return [];
      } catch (error) {
        console.warn('GNews API error:', error);
        return [];
      }
    }

    // Fetch from NewsAPI - FIXED IMAGE HANDLING
    async function fetchFromNewsAPI(lang, page = 1) {
      try {
        let query;
        if (lang === 'es') {
          query = 'conspiración OR "teoría conspirativa" OR "nuevo orden mundial" OR illuminati OR ufos';
        } else {
          query = 'conspiracy OR "conspiracy theory" OR "new world order" OR illuminati OR ufo OR "deep state" OR qanon';
        }
        
        const from = new Date(Date.now() - 30*24*60*60*1000).toISOString().split('T')[0];
        
        const proxyUrl = 'https://corsproxy.io/?';
        const targetUrl = `https://newsapi.org/v2/everything?q=${encodeURIComponent(query)}&language=${lang}&from=${from}&sortBy=publishedAt&pageSize=30&page=${page}&apiKey=${API_KEYS.NEWSAPI}`;
        
        const response = await fetch(proxyUrl + encodeURIComponent(targetUrl));
        const data = await response.json();
        
        if (data.articles) {
          return data.articles
            .filter(article => 
              article.title && 
              article.url && 
              article.source &&
              !article.title.toLowerCase().includes('[removed]') &&
              !article.title.toLowerCase().includes('removed')
            )
            .map(article => ({
              ...article,
              urlToImage: getImageUrl(article)
            }));
        }
        return [];
      } catch (error) {
        console.warn('NewsAPI error:', error);
        return [];
      }
    }

    // Fetch from NewsData API - FIXED IMAGE HANDLING
    async function fetchFromNewsData(lang, page = 1) {
      try {
        let query;
        if (lang === 'es') {
          query = 'conspiración,teoría conspirativa,nuevo orden mundial,illuminati,ufos';
        } else {
          query = 'conspiracy,conspiracy theory,new world order,illuminati,ufo,deep state';
        }
        
        const language = lang === 'es' ? 'es' : 'en';
        
        const url = `https://newsdata.io/api/1/news?apikey=${API_KEYS.NEWSDATA}&q=${encodeURIComponent(query)}&language=${language}&category=world`;
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.results) {
          return data.results
            .filter(article => 
              article.title && 
              article.link && 
              article.source_id &&
              !article.title.toLowerCase().includes('[removed]') &&
              !article.title.toLowerCase().includes('removed')
            )
            .map(article => ({
              title: article.title,
              description: article.description,
              url: article.link,
              urlToImage: getImageUrl(article),
              publishedAt: article.pubDate,
              source: { name: article.source_id }
            }));
        }
        return [];
      } catch (error) {
        console.warn('NewsData API error:', error);
        return [];
      }
    }

    // Main fetch function
    async function fetchNews(lang, page = 1) {
      let articles = [];
      
      try {
        // Try GNews first
        console.log(`Fetching from GNews API for ${lang}...`);
        articles = await fetchFromGNews(lang, page);
        
        if (articles.length > 0) {
          console.log(`GNews: Found ${articles.length} articles for ${lang}`);
          return articles;
        }

        // Try NewsAPI as backup
        console.log(`Trying NewsAPI for ${lang}...`);
        articles = await fetchFromNewsAPI(lang, page);
        
        if (articles.length > 0) {
          console.log(`NewsAPI: Found ${articles.length} articles for ${lang}`);
          return articles;
        }

        // Try NewsData as last resort
        console.log(`Trying NewsData for ${lang}...`);
        articles = await fetchFromNewsData(lang, page);
        
        if (articles.length > 0) {
          console.log(`NewsData: Found ${articles.length} articles for ${lang}`);
          return articles;
        }

        console.warn(`No articles found for ${lang} from any API`);
        return [];

      } catch (error) {
        console.error(`Error fetching news for ${lang}:`, error);
        return [];
      }
    }

    // Render articles with verification badge
    function renderArticles(articles, container, lang) {
      if (!articles.length) {
        container.innerHTML = `
          <div class="error-message">
            <i class="fas fa-exclamation-circle"></i>
            ${lang === 'es' ? 
              'No se encontraron noticias sobre conspiraciones en este momento.' : 
              'No conspiracy-related news found at this time.'}
          </div>`;
        return;
      }

      container.innerHTML = '';
      articles.forEach((article, index) => {
        const card = document.createElement('div');
        card.className = 'card';
        
        const publishedDate = new Date(article.publishedAt);
        const formattedDate = publishedDate.toLocaleDateString(
          lang === 'es' ? 'es-ES' : 'en-US',
          { year: 'numeric', month: 'long', day: 'numeric' }
        );
        
        const fallbackImage = 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=250&fit=crop&auto=format&q=80';
        
        card.innerHTML = `
          <img src="${article.urlToImage || fallbackImage}" 
               alt="${article.title}" 
               loading="lazy"
               onerror="this.src='${fallbackImage}'">
          <div class="card-content">
            <span class="date">${formattedDate}</span>
            <h3>${article.title} <span class="authenticity-badge">✓ Verificada</span></h3>
            <div class="source"><i class="fas fa-newspaper"></i> ${article.source.name || 'Unknown Source'}</div>
            ${article.description ? `<div class="description">${article.description}</div>` : ''}
            <a href="${article.url}" target="_blank" rel="noopener noreferrer">
              ${lang === 'es' ? 'Leer más →' : 'Read more →'}
            </a>
          </div>
        `;
        
        // Add loading animation
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        container.appendChild(card);
        
        // Animate card appearance
        setTimeout(() => {
          card.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
          card.style.opacity = '1';
          card.style.transform = 'translateY(0)';
        }, index * 100);
      });
    }

    // Load and display articles
    async function loadAndShowArticles() {
      if (isLoading) return;
      
      isLoading = true;
      loadMoreBtn.disabled = true;
      loadMoreBtn.textContent = loadMoreBtn.textContent.includes('Cargar') ? 'Cargando...' : 'Loading...';

      try {
        // Show API status
        apiStatus.style.display = 'block';

        // Load articles for both languages simultaneously
        const [newArticlesEs, newArticlesEn] = await Promise.all([
          fetchNews('es', currentPageEs),
          fetchNews('en', currentPageEn)
        ]);

        // Deduplicate new articles
        const uniqueNewEs = newArticlesEs.filter(newArt => !allArticlesEs.some(existing => existing.url === newArt.url));
        const uniqueNewEn = newArticlesEn.filter(newArt => !allArticlesEn.some(existing => existing.url === newArt.url));

        // Add new unique articles to existing ones
        if (uniqueNewEs.length > 0) {
          allArticlesEs = [...allArticlesEs, ...uniqueNewEs];
        }
        if (uniqueNewEn.length > 0) {
          allArticlesEn = [...allArticlesEn, ...uniqueNewEn];
        }

        // Calculate articles to show
        const articlesToShowEs = allArticlesEs.slice(0, currentPageEs * articlesPerPage);
        const articlesToShowEn = allArticlesEn.slice(0, currentPageEn * articlesPerPage);

        // Render articles
        renderArticles(articlesToShowEs, newsEsContainer, 'es');
        renderArticles(articlesToShowEn, newsEnContainer, 'en');

        // Update pagination
        const hasNewEs = uniqueNewEs.length > 0;
        const hasNewEn = uniqueNewEn.length > 0;

        if (hasNewEs || hasNewEn) {
          if (hasNewEs) currentPageEs++;
          if (hasNewEn) currentPageEn++;
          loadMoreBtn.disabled = false;
          loadMoreBtn.textContent = 'Cargar más noticias verificadas';
          loadMoreBtn.style.display = 'block';
        } else {
          loadMoreBtn.style.display = 'none';
        }

      } catch (error) {
        console.error('Error loading articles:', error);
        
        if (allArticlesEs.length === 0 && allArticlesEn.length === 0) {
          newsEsContainer.innerHTML = `
            <div class="error-message">
              <i class="fas fa-exclamation-triangle"></i> 
              Error al conectar con las APIs de noticias. Verifica tu conexión a internet.
            </div>`;
          newsEnContainer.innerHTML = `
            <div class="error-message">
              <i class="fas fa-exclamation-triangle"></i> 
              Error connecting to news APIs. Please check your internet connection.
            </div>`;
        }
        
        loadMoreBtn.disabled = false;
        loadMoreBtn.textContent = 'Cargar más noticias verificadas';
      } finally {
        isLoading = false;
      }
    }

    // Event listener for load more button
    loadMoreBtn.addEventListener('click', loadAndShowArticles);

    // Initial load
    loadAndShowArticles();
  </script>
</body>
</html>
